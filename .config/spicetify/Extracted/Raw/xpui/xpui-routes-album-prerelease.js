"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[8865],{2629:(e,t,r)=>{r.d(t,{p:()=>d});var a=r(30758),n=r(41978),s=r(75930),i=r(90751),l=r(83542),o=r(52608),c=r(11898),u=r(86070);const d=a.memo((function({uri:e,divider:t,removeLabel:r}){const d=(0,n.wA)(),m=!(0,o.n)(),p=(0,c.f)(),x=(0,a.useCallback)((async()=>{d((0,i.aw)(e,!0))}),[d,e]);return(0,u.jsx)(l.D,{role:"menuitem",divider:t,disabled:m&&!p?.getCapabilities().canModifyOffline,onClick:x,leadingIcon:(0,u.jsx)(s.k,{semanticColor:"textBrightAccent",size:"small"}),children:r})}))},40938:(e,t,r)=>{r.d(t,{P:()=>h});var a=r(30758),n=r(11808),s=r(66416),i=r(65183),l=r(72522),o=r(91039),c=r(79095),u=r(2629),d=r(95302),m=r(70583),p=r(6576),x=r(71817),f=r(86070);const h=a.memo((function({uri:e,artistUri:t,canPin:r=m.oT.NO,isPinned:a=!1,canRemove:h=!1}){const{spec:g}=(0,p.o)(e);return(0,f.jsx)(d.pZ,{value:"album",children:(0,f.jsxs)(s.W,{children:[h&&(0,f.jsx)(u.p,{uri:e,removeLabel:n.Ru.get("contextmenu.remove-from-library")}),t&&(0,f.jsx)(l.z,{spec:g,divider:"after",uri:t,displayText:n.Ru.get("contextmenu.go-to-artist-radio")}),r!==m.oT.NO&&(0,f.jsx)(c.k,{uri:e,canPin:r,isPinned:a,type:x.c.PRE_RELEASE_ALBUM,spec:g}),(0,f.jsx)(i.m,{uri:e,spec:g,displayText:n.Ru.get("context-menu.copy-album-link")}),(0,f.jsx)(o.q,{spec:g,divider:"before",uri:e})]})})}))},45085:(e,t,r)=>{r.r(t),r.d(t,{AlbumPrerelease:()=>ge});var a=r(97500),n=r.n(a),s=r(9183),i=r(12783),l=r(61544),o=r(11808),c=r(65570),u=r(31685),d=r(83028),m=r(30758),p=r(79203),x=r(97438),f=r(37712),h=r(97393),g=r(39796),b=r(40938),y=r(13786),j=r(43830),k=r(96764),v=r(72091),R=r(86070);const C=({uri:e})=>{const t=(0,k.V)(e),{spec:r,logger:a}=(0,v.r)(p.k,{data:{uri:e||""}}),n=(0,m.useCallback)((()=>{e&&(a.logInteraction(r.actionBarFactory().preSaveButtonFactory().hitUiNavigate({destination:e})),t())}),[t,r,e,a]);return e?(0,R.jsx)(j.$,{onClick:n,children:o.Ru.get("web-player.prerelease.listen_now")}):null};var P=r(69578);const T=({prerelease:e,backgroundColor:t})=>{const r=function(e){const[t,r]=(0,m.useState)((()=>!!e&&(0,c.u)(e)<=0));return(0,m.useEffect)((()=>{if(!e)return;const t=(0,c.u)(e);if(t<=0)return void r(!0);if(t>=36e5)return void r(!1);const a=setTimeout((()=>{r(!0)}),t);return()=>{clearTimeout(a)}}),[e]),t}(e.releaseDate),{spec:a,UBIFragment:n}=(0,v.r)(p.k,{data:{uri:e.uri}}),s=(0,P.j)();return(0,R.jsx)(x.E,{backgroundColor:t,children:(0,R.jsxs)(f.S,{children:[r?(0,R.jsx)(C,{uri:e.content?.uri}):(0,R.jsx)(y.v,{uri:e.uri}),(0,R.jsx)(n,{spec:a,children:(0,R.jsx)(g.b,{menu:(0,R.jsx)(b.P,{uri:e.uri,artistUri:e.content?.artists[0].uri}),children:(0,R.jsx)(h.e,{label:o.Ru.get("more.label.context",e.content?.name),size:s})})})]})})};var A=r(71588),I=r(64350),_=r(82442),w=r(56341),L=r(74793),E=r(59116),U=r(21752),D=r(51271),S=r(79056),N=r(55194),M=r(32994),z=r(42116),B=r(13797);const O="LFDgGRo4wD273tY6cKQ0",F=({prerelease:e,children:t})=>(0,R.jsx)(A.h,{menu:(0,R.jsx)(b.P,{uri:e.uri,artistUri:e.content?.artists[0].uri}),children:t}),W=({prerelease:e,backgroundColor:t})=>{const{content:r,releaseDate:a}=e,n=(0,z.y)(),s=n===M.E.SMALL||n===M.E.XSMALL,{spec:i,logger:l}=(0,v.r)(p.k,{data:{uri:e.uri}}),o=(0,m.useCallback)(((e,t)=>{if(i){const e=i.headerFactory().artistNameFactory().hitUiNavigate({destination:t.creator.uri});l.logInteraction(e)}}),[l,i]),c=r,u=(0,m.useMemo)((()=>a?new Date(a):void 0),[a]);return(0,R.jsxs)(_.z,{backgroundColor:t,size:_.K.LARGE,children:[(0,R.jsx)(E.h,{children:c.name?(0,R.jsx)(F,{prerelease:e,children:(0,R.jsx)(U.X,{text:c.name})}):null}),!s&&(0,R.jsx)(F,{prerelease:e,children:(0,R.jsx)(w.K,{images:c.coverArt.sources,name:c.name??"",placeholderType:"album"})}),(0,R.jsxs)(L.Y,{children:[(0,R.jsx)(S.B,{children:(0,B.C)(c.type)}),(0,R.jsx)(F,{prerelease:e,children:(0,R.jsx)(N.mm,{scaleAtMinWidth:N.Cl,children:c.name})}),(0,R.jsx)(D.t,{creators:c.artists,onCreatorClick:o,releaseDate:a,timeZone:e.timezone}),u&&c.name?(0,R.jsx)(I.G,{images:s?c.coverArt.sources:[],className:O,imageTitle:c.name,targetDate:u}):null]})]})};var G=r(89661),H=r(95973),K=r(45546),$=r(34892),q=r(46288),X=r(15742),Z=r(8385);const Y=new X.l("albumPreReleaseTracks","query","dfbdcf2688995adc2c2196fcdd7802b2a5137a2549b361aa7fb23cd6493f4672",null);var Q=r(69916),V=r(79787);const J={totalLength:0,items:[]};function ee(e){const t=e.preReleaseContent,r=[];if(t?.tracks)for(const e of t.tracks.items)r.push({uri:e.uri,name:e.name?e.name:"",isPlayable:e.playability.playable,durationMs:e.duration?.totalMilliseconds??0,hasOriginalAudio:e.hasOriginalAudio,artists:te(e.artists.items),isExplicit:e.contentRating?.label===V.x7.Explicit,is19PlusOnly:e.contentRating?.label===V.x7.NineteenPlus});return{totalLength:t?.tracks.totalCount??0,items:r}}function te(e){const t=[];for(const r of e)"Artist"===r.data.__typename&&t.push({name:r.data.profile.name,uri:r.data.uri});return t}const re=[q.$.INDEX,q.$.TITLE_AND_ARTIST,q.$.DURATION],ae=(0,m.memo)((function({ariaLabel:e,nrTracks:t,prereleaseUri:r,highlightUri:a,scrollToIndex:n,usePlayContextItem:s,hasHeaderRow:i=!0,initalTracks:l}){const{spec:o,UBIFragment:c}=(0,v.r)(p.k,{data:{uri:r}}),u=(e=>{const{request:t}=(0,m.useContext)(Q.j);return(0,m.useCallback)((async(r,a)=>{const n=await t(Y,{uri:e,offset:r,limit:a});for(const t of n?.data?.lookup||[])if("PreReleaseResponseWrapper"===t.__typename&&"PreRelease"===t.data.__typename&&t.data.uri===e)return ee(t.data);return J}),[t,e])})(r),d=(0,m.useRef)(!1),x=(0,m.useRef)(null),[f,h]=(0,m.useState)(null),g=(0,m.useCallback)((e=>({uri:e.uri})),[]);(0,m.useEffect)((()=>{x.current&&(f?x.current.scrollToIndex(f):n&&x.current.scrollToIndex(n))}),[f,n]);const b=(0,m.useCallback)((async(e,t)=>{const r=await u(e,t);if(a&&!f){const e=r.items.findIndex((e=>e?.uri===a));h(e||-1)}return r}),[u,a,f]),y=(0,m.useCallback)(((e,t)=>{const n=!d.current&&!!a&&a===e.uri;return n&&(d.current=!0),(0,R.jsx)(H.d,{uri:e.uri,isPlayable:e.isPlayable,name:e.name,trackNumber:t+1,index:t,artists:e.artists,playcount:0,contextUri:r,duration_ms:e.hasOriginalAudio?e.durationMs:null,usePlayContextItem:s,isMOGEFRestricted:e.is19PlusOnly,isExplicit:e.isExplicit,shouldHighLight:n,isReleased:e.isPlayable},t+e.uri)}),[a,r,s]);return(0,R.jsx)(c,{spec:o,children:(0,R.jsx)($.a,{columns:re,children:(0,R.jsx)(K.S4,{ariaLabel:e,columns:re,hasHeaderRow:i,rowPlaceholder:G.Bz,renderRow:y,resolveItem:g,nrTracks:t,fetchTracks:b,limit:300,tracks:l,outerRef:x,columnPersistenceKey:"album-tracklist"},r)})})})),ne=new X.l("albumPreRelease","query","cb7e121ae0c2d105ea9a8a5c8a003e520f333e0e94073032dcdbd548dd205d66",null),se=(e,t)=>(0,Z.I)(ne,e,t),ie=(e,t=se)=>{const{data:r,loading:a,error:n}=t({uri:e},{staleTime:3e5,gcTime:36e5});return{loading:a,error:!!n,prerelease:(0,m.useMemo)((()=>{if(!r)return null;for(const t of r.lookup)if("PreReleaseResponseWrapper"===t.__typename&&"PreRelease"===t.data.__typename&&t.data.uri===e)return oe(t.data);return null}),[r,e])}};function le(e){return e.includes("â„—")?{type:"P",text:e}:{type:"C",text:e}}function oe(e){const t=e.preReleaseContent;let r;if(t){const a=ee(e);r={artists:ce(t.artists.items),name:t.name??void 0,uri:t.uri,coverArt:{extractedColors:t.coverArt?.extractedColors?.colorRaw,sources:t.coverArt?.sources??[]},type:t.type,tracks:a,copyrights:t.copyright?.split("\n").map(le)??[]}}return{uri:e.uri,releaseDate:e.releaseDate?.isoString,timezone:e.timezone??void 0,content:r}}function ce(e){const t=[];for(const r of e)"Artist"===r.data.__typename&&t.push({name:r.data.profile.name,id:r.data.id,uri:r.data.uri,images:r.data.visuals.avatarImage?.sources??[]});return t}var ue=r(12669);var de=r(15891),me=r(71296),pe=r(42582),xe=r(71817);const fe="IVrwmRlzBI3lrWleZGbW",he="nPhSYFMXHpfImT4H04k3",ge=e=>{const{uri:t}=e,{prerelease:r,loading:a,error:m}=ie(t),p=(e=>{const t=e?.content?.coverArt.extractedColors?.hex;return(0,ue.z)(t),t})(r),x=parseInt(new URLSearchParams((0,s.zy)().search).get("index")||"0",10),{usePlayContextItem:f}=(0,pe.P)({uri:t,pages:[{items:(h=r?.content?.tracks.items||[],h.filter((e=>e.isPlayable)).map((e=>({uri:e.uri,uid:null,type:xe.c.TRACK,provider:null}))))}]},{featureIdentifier:"album_prerelease"});var h;if(a||m||!r)return(0,R.jsx)(d.A,{hasError:!!m,errorMessage:o.Ru.get("error.not_found.title.album")});if(r?.content?.uri&&function(e,t){if(!e.content?.uri||!e.releaseDate)return!1;const r=(0,c.u)(e.releaseDate);if(r>0)return!1;return r<=-1*t}(r,1728e5)){const e=(0,l.cA)(r?.content?.uri);if(e)return(0,R.jsx)(de.$,{to:e.toURLPath(!0)})}return(0,R.jsxs)("section",{className:fe,children:[(0,R.jsx)(u.Q,{children:o.Ru.get("album.page-title",r.content?.name??"")}),(0,R.jsx)(W,{prerelease:r,backgroundColor:p}),(0,R.jsx)(T,{prerelease:r,backgroundColor:p}),r.content?.tracks.totalLength?(0,R.jsxs)("div",{className:"contentSpacing",children:[(0,R.jsx)(i.E,{as:"h2",variant:"titleSmall",semanticColor:"textBase",children:o.Ru.get("web-player.prerelease.album_tracklist_preview")}),(0,R.jsx)(ae,{prereleaseUri:t,ariaLabel:r.content?.name??o.Ru.get("error.not_found.title.album"),nrTracks:r.content?.tracks.totalLength??0,scrollToIndex:x,usePlayContextItem:f,initalTracks:r.content?.tracks.items,albumUri:r.content?.uri})]}):null,(0,R.jsx)("div",{className:n()(he,"contentSpacing"),children:(0,R.jsx)(me.Z,{copyrights:r.content?.copyrights??[]})})]})}}}]);
//# sourceMappingURL=xpui-routes-album-prerelease.js.map